{% extends 'base.html' %}

{% block title %}Dashboard - Car Wash System{% endblock %}

{% block navigation %}
{% if user.is_staff or user.is_superuser %}
    {{ block.super }}
{% else %}
<!-- Top Navigation Bar -->
<div style="background: #ffffff; border-bottom: 1px solid #e5e7eb; padding: 1rem 2rem;">
    <div style="max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;">
        <div style="font-size: 1.125rem; font-weight: 600; color: #111827;">Car Wash System</div>
        <div style="display: flex; align-items: center; gap: 2rem;">
            <a href="{% url 'user_dashboard' %}" style="color: #111827; text-decoration: none; font-size: 0.875rem; font-weight: 500;">Dashboard</a>
            <a href="{% url 'user_services' %}" style="color: #6b7280; text-decoration: none; font-size: 0.875rem;">Services</a>
            <a href="{% url 'user_bookings' %}" style="color: #6b7280; text-decoration: none; font-size: 0.875rem;">Bookings</a>
            <div style="display: flex; align-items: center; gap: 1rem; margin-left: 1rem; padding-left: 2rem; border-left: 1px solid #e5e7eb;">
                <span style="color: #6b7280; font-size: 0.875rem;">{{ user.username }}</span>
                <a href="{% url 'logout' %}" style="color: #6b7280; text-decoration: none;" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block content %}
<div style="max-width: 1400px; margin: 0 auto; padding: 2rem;">

<!-- Statistics Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
    <!-- Total Bookings -->
    <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 1.5rem;">
        <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.5rem;">Total Bookings</p>
        <h2 style="font-size: 2rem; font-weight: 700; color: #111827; margin-bottom: 0.25rem;">{{ total_bookings }}</h2>
        <p style="color: #6b7280; font-size: 0.75rem;">All time</p>
    </div>
    
    <!-- Pending -->
    <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 1.5rem;">
        <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.5rem;">Pending</p>
        <h2 style="font-size: 2rem; font-weight: 700; color: #111827; margin-bottom: 0.25rem;">{{ pending_bookings }}</h2>
        <p style="color: #6b7280; font-size: 0.75rem;">Awaiting confirmation</p>
    </div>
    
    <!-- Completed -->
    <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 1.5rem;">
        <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.5rem;">Completed</p>
        <h2 style="font-size: 2rem; font-weight: 700; color: #111827; margin-bottom: 0.25rem;">{{ completed_bookings }}</h2>
        <p style="color: #6b7280; font-size: 0.75rem;">Successfully done</p>
    </div>
</div>

<!-- Weather Widget -->
{% if weather %}
<div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
    <h2 style="font-size: 1.25rem; font-weight: 600; color: #111827; margin-bottom: 1.5rem;"><i class="fas fa-cloud-sun" style="color: #3b82f6; margin-right: 0.5rem;"></i>Current Weather</h2>
    
    {% if not weather.error %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
            <div>
                <p style="margin-bottom: 0.5rem; color: #6b7280; font-size: 0.875rem;">Location</p>
                <p style="font-size: 1.125rem; color: #111827; font-weight: 500;">{{ weather.location }}</p>
            </div>
            <div>
                <p style="margin-bottom: 0.5rem; color: #6b7280; font-size: 0.875rem;">Temperature</p>
                <p style="font-size: 1.125rem; color: #111827; font-weight: 500;">{{ weather.temperature }}°C</p>
            </div>
            <div>
                <p style="margin-bottom: 0.5rem; color: #6b7280; font-size: 0.875rem;">Condition</p>
                <p style="font-size: 1.125rem; color: #111827; font-weight: 500;">{{ weather.condition }}</p>
            </div>
            <div>
                <p style="margin-bottom: 0.5rem; color: #6b7280; font-size: 0.875rem;">Humidity</p>
                <p style="font-size: 1.125rem; color: #111827; font-weight: 500;">{{ weather.humidity }}%</p>
            </div>
        </div>
        
        <div style="padding: 1rem; background: #eff6ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
            <i class="fas fa-info-circle" style="color: #3b82f6; margin-right: 0.5rem;"></i>
            <strong style="color: #111827;">Recommendation:</strong> <span style="color: #6b7280;">{{ weather.recommendation }}</span>
        </div>
    {% else %}
        <p style="color: #6b7280;"><i class="fas fa-exclamation-triangle"></i> {{ weather.recommendation }}</p>
    {% endif %}
</div>
{% endif %}

<!-- Next Bookings Section -->
<div id="dashboardSection" style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <div>
            <h2 style="font-size: 1.25rem; font-weight: 600; color: #111827; margin-bottom: 0.25rem;">Next Bookings</h2>
            <p style="color: #6b7280; font-size: 0.875rem;">Your upcoming appointments</p>
        </div>
        {% if not user.is_staff and not user.is_superuser %}
        <a href="{% url 'user_services' %}" class="btn btn-primary" style="padding: 0.75rem 1.5rem; font-size: 0.875rem;">
            <i class="fas fa-plus"></i> New Booking
        </a>
        {% endif %}
    </div>
    
    {% if bookings %}
        <div style="display: grid; gap: 1rem;">
            {% for booking in bookings|slice:":3" %}
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                            <h3 style="font-size: 1rem; font-weight: 600; color: #111827;">{{ booking.get_service_display }}</h3>
                            <span class="badge badge-{{ booking.status }}" style="padding: 0.375rem 0.75rem; border-radius: 6px; font-size: 0.875rem;">
                                {{ booking.get_status_display }}
                            </span>
                        </div>
                        <div style="display: flex; gap: 2rem; color: #6b7280; font-size: 0.875rem;">
                            <span><i class="fas fa-calendar" style="margin-right: 0.5rem;"></i>{{ booking.booking_date|date:"M d, Y" }}</span>
                            <span><i class="fas fa-clock" style="margin-right: 0.5rem;"></i>{{ booking.booking_time|time:"H:i" }}</span>
                            <span><i class="fas fa-car" style="margin-right: 0.5rem;"></i>{{ booking.get_vehicle_type_display }} - {{ booking.vehicle_plate }}</span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #111827; margin-bottom: 0.5rem;">₱{{ booking.price }}</div>
                        <a href="{% url 'booking_detail' booking.id %}" style="color: #6b7280; text-decoration: none; font-size: 0.875rem;">
                            View Details <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 3rem; color: #6b7280;">
            <i class="fas fa-calendar" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
            <p>No upcoming bookings. <a href="{% url 'user_services' %}" style="color: #111827; font-weight: 600;">Browse services</a></p>
        </div>
    {% endif %}
</div>

{% endblock %}

{% block footer %}{% endblock %}
